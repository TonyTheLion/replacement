---
# static variable assignments to ad-hoc keys
# all keys are available for substitution in replacement directives
title: skeleton
description: a skeleton template to show 'replacement' data model
version: 1.0

# list of directives
replacement:
  # each list item is a 'block' - it corresponds to a single function invocation
  - literal: |
      This text will be output literally.
  - literal: |  # this is another block
      Today we discuss {description}
  - process: format  # process all preceding text through Python str.format()

  - replacement:  # recurse
      - exec: import datetime  # executes but does *not* capture output
      - set: date  # only this block will see a 'date' variable when processing
        eval: |
          str(datetime.date.today())
      - literal: |
          date - {date}
      - process: format  # only processes output lines from inside this block

  - set: version  # clobber 'version' in the substitutions dictionary
    eval: |
      {version} + 0.1
    substitute: format  # str.format() the text of variables in this block
    # NOTE str.format() will see old value of 'version'
    # NOTE valid values of 'substitute' are the same as for 'process'

  - replacement:
      - file: |  # read contents of file at this path
          a_file.txt
      - file: |
          source_v{version}-{random}.txt
        random: 42  # another example of ad-hoc variable assignment
        substitute: format
      - process: safe_substitute  # use string.template for '$var' constructs
      # NOTE 'process' operates on the output of both 'file' directives

# TODO how to process multiple inputs
...
